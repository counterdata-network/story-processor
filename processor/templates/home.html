{% extends "base.html" %}

{% block content %}

<div class="row">
    <div class="col-12">
        <div class="jumbotron">
            <h1 class="display-4">Media Cloud Story Processor v{{version}}</h1>
            <p class="lead">
            Grab stories from Media Cloud, run them against trained classifiers, post results to another server.
            </p>
        </div>
    </div>
</div>

<div id="results"></div>

<h2>Projects
<div style="float:right"><button type="button" id="update" class="btn btn-primary">Update config now!</button></div>
</h2>

<div class="row">
    <div class="col-lg-12">
        <table class="table">
            <tr>
                <th>Id</th>
                <th>Title</th>
                <th>Model</th>
                <th>Latest</th>
                <th>Local</th>
            </tr>
            {% for p in projects %}
                <tr>
                    <td>{{ p['id'] }}</td>
                    <td><a href="/projects/{{ p['id'] }}">{{ p['title'] }}</a></td>
                    <td>{{ p['language_model'] }}</td>
                    <td>{{ p['latest_processed_stories_id'] }}</td>
                    <td>{{ p['local_processed_stories_id'] }}</td>
                </tr>
            {% endfor %}
        </table>
    </div>
</div>

{% endblock %}

{% block page_scripts %}

$("#update").click(function(){
// show feedback while fetching results
showSpinner('#results');
// ask server to update config
$.post({
  url: "/update-config",
}).done(function(response){
  // if server responds well then display JSON
  console.info(response);
  $('#results').html('<div class="alert alert-success" role="alert">✅️ Updated with '+response.length+' projects</div>');
}).fail(function() {
  // if server failed show error msg
  $('#results').html('<div class="alert alert-danger" role="alert">⚠️ Something went wrong</div>');
});
})

{% endblock %}
